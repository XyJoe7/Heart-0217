<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>å¿ƒè±¡ç ”ç©¶æ‰€</title>
  <meta name="description" content="ä¸“ä¸šå¿ƒç†æµ‹è¯„å¹³å° â€” æ¶µç›–æƒ…ç»ªã€äººæ ¼ã€æ‹çˆ±ã€èŒä¸šç­‰å¤šç»´åº¦å¿ƒç†è‡ªæµ‹å·¥å…·ã€‚" />
  <meta name="robots" content="index,follow" />
  <link rel="canonical" href="/" />
  <link rel="stylesheet" href="/assets/style.css" />
  <link rel="stylesheet" href="/assets/pages.css" />
  <style>
    /* ====== Home-specific layout ====== */
    body{padding-bottom:0}

    /* â”€â”€ Shared top bar â”€â”€ */
    .top-bar{position:sticky;top:0;z-index:20;backdrop-filter:saturate(160%) blur(10px);background:rgba(253,239,249,.55);border-bottom:1px solid rgba(0,0,0,.06);padding:10px 16px}
    .top-bar-inner{display:flex;align-items:center;gap:12px;max-width:1100px;margin:0 auto}
    .top-bar .logo-sm{width:38px;height:38px;border-radius:10px;background:linear-gradient(135deg,var(--primary),var(--accent));box-shadow:0 6px 16px rgba(255,107,157,.18);flex:0 0 auto;position:relative}
    .top-bar .logo-sm::after{content:"";position:absolute;inset:7px;border-radius:7px;background:rgba(255,255,255,.6);mix-blend-mode:overlay}
    .top-bar .search-bar{flex:1;display:flex;align-items:center;gap:8px;background:rgba(255,255,255,.8);border:1px solid rgba(0,0,0,.06);border-radius:999px;padding:8px 14px}
    .top-bar .search-bar svg{width:16px;height:16px;opacity:.55;flex:0 0 auto}
    .top-bar .search-bar input{border:0;outline:0;background:transparent;width:100%;font-size:14px}
    .top-bar .search-bar:focus-within{box-shadow:var(--ring);border-color:rgba(124,131,253,.3)}

    /* â”€â”€ Tab Content Area â”€â”€ */
    .tab-page{display:none;position:relative;z-index:5}
    .tab-page.active{display:block}

    /* â”€â”€ Bottom navigation â”€â”€ */
    .bottom-nav{position:fixed;bottom:0;left:0;right:0;z-index:50;background:rgba(255,255,255,.92);backdrop-filter:saturate(160%) blur(10px);border-top:1px solid rgba(0,0,0,.06);display:flex;justify-content:space-around;align-items:center;padding:6px 0 env(safe-area-inset-bottom,6px);box-shadow:0 -4px 16px rgba(0,0,0,.04)}
    .bottom-nav a{display:flex;flex-direction:column;align-items:center;gap:2px;text-decoration:none;color:var(--muted);font-size:11px;font-weight:700;padding:4px 16px;border-radius:8px;transition:.18s ease;cursor:pointer;-webkit-tap-highlight-color:transparent;user-select:none}
    .bottom-nav a svg{width:22px;height:22px}
    .bottom-nav a.active{color:var(--primary)}
    .bottom-nav a.active svg{stroke:var(--primary)}

    /* â”€â”€ Carousel â”€â”€ */
    .carousel{position:relative;overflow:hidden;border-radius:var(--radius);margin-bottom:18px}
    .carousel-track{display:flex;transition:transform .4s ease}
    .carousel-slide{min-width:100%;aspect-ratio:2.4/1;border-radius:var(--radius);display:flex;align-items:center;justify-content:center;padding:24px;color:#fff;position:relative;overflow:hidden}
    .carousel-slide .slide-text{position:relative;z-index:2;text-align:center}
    .carousel-slide .slide-text h2{margin:0 0 6px;font-size:clamp(18px,3vw,28px);text-shadow:0 2px 8px rgba(0,0,0,.15)}
    .carousel-slide .slide-text p{margin:0;font-size:clamp(12px,1.8vw,16px);opacity:.9}
    .carousel-dots{position:absolute;bottom:10px;left:50%;transform:translateX(-50%);display:flex;gap:6px;z-index:3}
    .carousel-dots span{width:8px;height:8px;border-radius:999px;background:rgba(255,255,255,.45);cursor:pointer;transition:.18s ease}
    .carousel-dots span.active{background:#fff;width:20px}

    /* â”€â”€ Section titles â”€â”€ */
    .sec-head{display:flex;align-items:center;justify-content:space-between;margin:20px 0 12px}
    .sec-head h3{margin:0;font-size:17px;display:flex;align-items:center;gap:6px}
    .sec-head .more{color:var(--muted);font-size:13px;text-decoration:none;font-weight:700}

    /* â”€â”€ Category quick links â”€â”€ */
    .cat-row{display:flex;gap:12px;overflow-x:auto;padding-bottom:4px;-webkit-overflow-scrolling:touch;scrollbar-width:none}
    .cat-row::-webkit-scrollbar{display:none}
    .cat-item{display:flex;flex-direction:column;align-items:center;gap:6px;text-decoration:none;color:var(--text);min-width:68px;flex:0 0 auto;cursor:pointer;-webkit-tap-highlight-color:transparent}
    .cat-icon{width:48px;height:48px;border-radius:14px;display:grid;place-items:center;font-size:22px;background:rgba(255,255,255,.85);border:1px solid rgba(0,0,0,.06);box-shadow:0 4px 12px rgba(0,0,0,.05);transition:.18s ease}
    .cat-item:hover .cat-icon{transform:translateY(-2px);box-shadow:var(--shadow)}
    .cat-item span{font-size:12px;font-weight:700;white-space:nowrap}

    /* â”€â”€ Horizontal scroll row â”€â”€ */
    .scroll-row{display:flex;gap:12px;overflow-x:auto;padding-bottom:6px;-webkit-overflow-scrolling:touch;scrollbar-width:none}
    .scroll-row::-webkit-scrollbar{display:none}
    .h-card{flex:0 0 auto;width:150px;background:var(--card);border-radius:var(--radius);box-shadow:var(--shadow);border:1px solid rgba(0,0,0,.06);overflow:hidden;text-decoration:none;color:var(--text);transition:.18s ease;cursor:pointer}
    .h-card:hover{transform:translateY(-4px);box-shadow:var(--shadow2)}
    .h-card-img{height:100px;display:flex;align-items:center;justify-content:center;font-size:32px;position:relative;overflow:hidden}
    .h-card-body{padding:10px}
    .h-card-body .name{font-weight:900;font-size:13px;line-height:1.35;display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden}

    /* â”€â”€ New arrivals grid â”€â”€ */
    .new-grid{display:grid;grid-template-columns:repeat(3,minmax(0,1fr));gap:10px}
    .n-card{background:var(--card);border-radius:var(--radius);box-shadow:var(--shadow);border:1px solid rgba(0,0,0,.06);overflow:hidden;text-decoration:none;color:var(--text);transition:.18s ease;cursor:pointer}
    .n-card:hover{transform:translateY(-4px);box-shadow:var(--shadow2)}
    .n-card-img{aspect-ratio:1/1;display:flex;align-items:center;justify-content:center;font-size:28px;position:relative;overflow:hidden}
    .n-card-body{padding:8px 10px}
    .n-card-body .name{font-weight:900;font-size:12px;line-height:1.35;display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden}
    @media(max-width:560px){.new-grid{grid-template-columns:repeat(2,minmax(0,1fr))}}

    /* â”€â”€ Featured list (vertical) â”€â”€ */
    .feat-list{display:flex;flex-direction:column;gap:12px}
    .feat-card{display:flex;gap:12px;background:var(--card);border-radius:var(--radius);box-shadow:var(--shadow);border:1px solid rgba(0,0,0,.06);padding:12px;transition:.18s ease;text-decoration:none;color:var(--text);cursor:pointer}
    .feat-card:hover{transform:translateY(-3px);box-shadow:var(--shadow2)}
    .feat-card-img{width:80px;height:80px;border-radius:12px;display:flex;align-items:center;justify-content:center;font-size:28px;flex:0 0 auto;position:relative;overflow:hidden}
    .feat-card-body{flex:1;min-width:0;display:flex;flex-direction:column;justify-content:center}
    .feat-card-body .question{font-size:12px;color:var(--accent);font-weight:700;margin-bottom:4px;padding:0;background:none;border:none;border-radius:0}
    .feat-card-body .name{font-weight:900;font-size:14px;line-height:1.35}
    .feat-card-body .meta-row{display:flex;align-items:center;gap:8px;margin-top:6px;font-size:12px;color:var(--muted)}
    .feat-card-body .meta-row .people{display:flex;align-items:center;gap:3px}

    .view-more-btn{display:block;width:100%;padding:14px;border:1px solid rgba(0,0,0,.08);border-radius:999px;background:rgba(255,255,255,.8);text-align:center;font-weight:900;font-size:14px;color:var(--primary2);cursor:pointer;transition:.18s ease;text-decoration:none;margin:22px 0 10px}
    .view-more-btn:hover{background:rgba(255,255,255,1);box-shadow:var(--shadow)}

    /* â”€â”€ Category page â”€â”€ */
    .cat-layout{display:flex;gap:14px;min-height:60vh}
    .cat-sidebar{width:100px;flex:0 0 auto;display:flex;flex-direction:column;gap:2px;background:rgba(255,255,255,.65);border-radius:var(--radius);padding:8px;overflow-y:auto;max-height:calc(100vh - 180px);position:sticky;top:70px}
    .cat-sidebar button{border:0;background:transparent;padding:10px 8px;border-radius:10px;font-size:13px;font-weight:700;cursor:pointer;text-align:center;transition:.16s ease;color:#555}
    .cat-sidebar button.active{background:linear-gradient(135deg,var(--primary),var(--accent));color:#fff;box-shadow:0 6px 16px rgba(124,131,253,.18)}
    .cat-sidebar button:hover:not(.active){background:rgba(124,131,253,.08)}
    .cat-main{flex:1;min-width:0}
    .sort-bar{display:flex;gap:8px;align-items:center;margin-bottom:12px;flex-wrap:wrap}
    .sort-btn{border:1px solid rgba(0,0,0,.08);background:rgba(255,255,255,.75);padding:7px 14px;border-radius:999px;cursor:pointer;font-size:12px;font-weight:700;transition:.16s ease;color:#555}
    .sort-btn.active{background:linear-gradient(135deg,var(--primary),var(--accent));color:#fff;border-color:transparent}
    .cat-list{display:flex;flex-direction:column;gap:12px}

    @media(max-width:640px){
      .cat-sidebar{width:80px;font-size:12px}
      .cat-sidebar button{padding:8px 4px;font-size:12px}
    }

    /* â”€â”€ My page â”€â”€ */
    .my-wrap{max-width:560px;margin:0 auto;padding:20px 0}
    .my-avatar{width:64px;height:64px;border-radius:999px;background:linear-gradient(135deg,var(--primary),var(--accent));display:grid;place-items:center;color:#fff;font-size:28px;margin:0 auto 12px}
    .my-card{background:var(--card);border-radius:var(--radius);box-shadow:var(--shadow);border:1px solid rgba(0,0,0,.06);padding:16px;margin-bottom:12px}
    .my-card h4{margin:0 0 10px;font-size:15px}
    .my-links{display:flex;flex-direction:column;gap:8px}
    .my-link{display:flex;align-items:center;gap:10px;padding:12px;border-radius:12px;border:1px solid rgba(0,0,0,.06);background:rgba(255,255,255,.8);text-decoration:none;color:var(--text);font-weight:700;font-size:14px;transition:.16s ease}
    .my-link:hover{background:#fff;box-shadow:var(--shadow)}
    .my-link svg{width:20px;height:20px;opacity:.65}
  </style>
  <script src="/assets/auth.js"></script>
  <script src="/assets/tests.js"></script>
</head>
<body>
  <div class="floating-bubbles" aria-hidden="true" id="bubbles"></div>

  <!-- â•â•â• Top Bar â•â•â• -->
  <header class="top-bar">
    <div class="top-bar-inner">
      <a href="/" style="text-decoration:none;display:flex;align-items:center;gap:8px">
        <span class="logo-sm" aria-hidden="true"></span>
        <span style="font-weight:900;font-size:15px;white-space:nowrap" id="brandName">å¿ƒè±¡ç ”ç©¶æ‰€</span>
      </a>
      <div class="search-bar">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg>
        <input type="search" id="globalSearch" placeholder="æœç´¢æµ‹è¯„â€¦" autocomplete="off" />
      </div>
    </div>
  </header>

  <!-- â•â•â• Tab Pages â•â•â• -->
  <main class="container" style="padding-top:14px;padding-bottom:12px">

    <!-- â”€â”€ HOME â”€â”€ -->
    <section id="tabHome" class="tab-page active">
      <!-- Carousel -->
      <div class="carousel" id="carousel">
        <div class="carousel-track" id="carouselTrack"></div>
        <div class="carousel-dots" id="carouselDots"></div>
      </div>

      <!-- Category quick links -->
      <div class="sec-head"><h3><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="vertical-align:text-bottom;margin-right:4px"><path d="M3 3h7v7H3V3zm11 0h7v7h-7V3zM3 14h7v7H3v-7zm11 0h7v7h-7v-7z"/></svg>åˆ†ç±»</h3><a class="more" href="javascript:void(0)" id="catMore">å…¨éƒ¨ &rsaquo;</a></div>
      <div class="cat-row" id="catRow"></div>

      <!-- Hot items -->
      <div class="sec-head"><h3><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="vertical-align:text-bottom;margin-right:4px"><path d="M13.73 4a2 2 0 0 0-3.46 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3l-8-14z"/></svg>çƒ­é—¨çˆ†æ¬¾</h3></div>
      <div class="scroll-row" id="hotRow"></div>

      <!-- New arrivals -->
      <div class="sec-head"><h3><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="vertical-align:text-bottom;margin-right:4px"><path d="M12 2v20M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/></svg>æ–°å“é¦–å‘</h3></div>
      <div class="new-grid" id="newGrid"></div>

      <!-- Featured recommendations -->
      <div class="sec-head"><h3><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="vertical-align:text-bottom;margin-right:4px"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/></svg>ç²¾é€‰æ¨è</h3></div>
      <div class="feat-list" id="featList"></div>

      <!-- View More -->
      <a class="view-more-btn" href="javascript:void(0)" id="viewMoreBtn">æŸ¥çœ‹æ›´å¤š &rsaquo;</a>
    </section>

    <!-- â”€â”€ CATEGORY â”€â”€ -->
    <section id="tabCategory" class="tab-page">
      <div class="cat-layout">
        <aside class="cat-sidebar" id="catSidebar"></aside>
        <div class="cat-main">
          <div class="sort-bar" id="sortBar"></div>
          <div class="cat-list" id="catList"></div>
        </div>
      </div>
    </section>

    <!-- â”€â”€ MY â”€â”€ -->
    <section id="tabMy" class="tab-page">
      <div class="my-wrap">
        <div style="text-align:center;padding:20px 0">
          <div class="my-avatar">ğŸ‘¤</div>
          <div style="font-weight:900;font-size:18px" id="myStatusTitle">æœªæ¿€æ´»</div>
          <div style="color:var(--muted);font-size:13px;margin-top:4px" id="myStatusSub">æ¿€æ´»åå³å¯ä½¿ç”¨å…¨éƒ¨æµ‹è¯„</div>
        </div>

        <div class="my-card" id="myAuthCard">
          <h4>æƒé™çŠ¶æ€</h4>
          <div id="myAuthInfo" style="color:var(--muted);font-size:13px;line-height:1.7">æ£€æŸ¥ä¸­â€¦</div>
          <div style="margin-top:12px">
            <a class="go" href="/code" id="myActivateBtn">æ¿€æ´»æƒé™</a>
          </div>
        </div>

        <div class="my-card">
          <h4>å¿«æ·å…¥å£</h4>
          <div class="my-links">
            <a class="my-link" href="/about/">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><line x1="12" y1="16" x2="12" y2="12"/><line x1="12" y1="8" x2="12.01" y2="8"/></svg>
              å…³äºæœ¬ç«™
            </a>
            <a class="my-link" href="/faq/">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"/><line x1="12" y1="17" x2="12.01" y2="17"/></svg>
              å¸¸è§é—®é¢˜
            </a>
            <a class="my-link" href="/cooperate/">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M23 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></svg>
              åˆä½œè”ç³»
            </a>
            <a class="my-link" href="/legal/terms/">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/></svg>
              ç”¨æˆ·åè®®
            </a>
            <a class="my-link" href="/legal/privacy/">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="11" width="18" height="11" rx="2" ry="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/></svg>
              éšç§è¯´æ˜
            </a>
          </div>
        </div>
      </div>
    </section>

  </main>

  <!-- â•â•â• Footer â•â•â• -->
  <footer class="site-footer-block" style="padding-bottom:calc(86px + env(safe-area-inset-bottom,0px))">
    <div class="links">
      <a href="/about/">å…³äºæœ¬ç«™</a><a href="/faq/">å¸¸è§é—®é¢˜</a><a href="/sitemap-page/">ç½‘ç«™åœ°å›¾</a><a href="/legal/terms/">ç”¨æˆ·åè®®</a><a href="/legal/privacy/">éšç§è¯´æ˜</a>
    </div>
    <div class="record">
      <span id="icpText">ICPå¤‡æ¡ˆå·å¾…å¡«å†™</span>
    </div>
  </footer>

  <!-- â•â•â• Bottom Nav â•â•â• -->
  <nav class="bottom-nav" id="bottomNav">
    <a data-tab="home" class="active">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg>
      é¦–é¡µ
    </a>
    <a data-tab="category">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="7" height="7"/><rect x="14" y="3" width="7" height="7"/><rect x="3" y="14" width="7" height="7"/><rect x="14" y="14" width="7" height="7"/></svg>
      åˆ†ç±»
    </a>
    <a data-tab="my">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>
      æˆ‘çš„
    </a>
  </nav>

  <div class="toast" id="toast" role="status" aria-live="polite" aria-atomic="true"></div>

  <script>
  /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     Home Page Logic
     â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
  (function(){
    "use strict";

    /* â”€â”€ Helpers â”€â”€ */
    function escapeHtml(str){
      return String(str).replace(/[&<>"']/g, s=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'})[s]);
    }
    function $(sel,el){return(el||document).querySelector(sel)}
    function $$(sel,el){return Array.from((el||document).querySelectorAll(sel))}
    function viewPath(id){return "/view/"+encodeURIComponent(id)+"/"}
    function isAuthed(){return !!(window.Auth&&window.Auth.getAuth&&window.Auth.getAuth().ok)}

    /* Deterministic "people tested" count from test ID */
    function peopleTested(id){
      var h=0;for(var i=0;i<id.length;i++){h=((h<<5)-h)+id.charCodeAt(i);h|=0}
      return Math.abs(h%8000)+1200;
    }

    /* Category icon map */
    var CAT_ICONS={"æƒ…ç»ªé‡è¡¨":"ğŸ’™","äººæ ¼æ€§æ ¼":"ğŸ§©","æ‹çˆ±å…³ç³»":"â¤ï¸","è‡ªæˆ‘æ¢ç´¢":"ğŸ”","èŒä¸šå¤©èµ‹":"ğŸ’¼","è¶£å‘³å¤–è²Œ":"âœ¨"};
    /* Category gradient map for card images */
    var CAT_GRADIENTS={
      "æƒ…ç»ªé‡è¡¨":"linear-gradient(135deg,#667eea,#764ba2)",
      "äººæ ¼æ€§æ ¼":"linear-gradient(135deg,#f093fb,#f5576c)",
      "æ‹çˆ±å…³ç³»":"linear-gradient(135deg,#ff9a9e,#fad0c4)",
      "è‡ªæˆ‘æ¢ç´¢":"linear-gradient(135deg,#a18cd1,#fbc2eb)",
      "èŒä¸šå¤©èµ‹":"linear-gradient(135deg,#ffecd2,#fcb69f)",
      "è¶£å‘³å¤–è²Œ":"linear-gradient(135deg,#89f7fe,#66a6ff)"
    };

    var categories=[];
    var catSet={};
    if(typeof TESTS!=="undefined"){
      TESTS.forEach(function(t){
        if(t.category&&!catSet[t.category]){catSet[t.category]=true;categories.push(t.category)}
      });
    }

    /* â•â• Site Settings â•â• */
    function loadSiteSettings(){
      fetch("/api/site_public.php").then(function(r){return r.json()}).then(function(j){
        if(!j.ok)return;
        var s=j.settings;
        if(s.siteName){
          var el=document.getElementById("brandName");if(el)el.textContent=s.siteName;
          document.title=s.siteName;
        }
        var icp=document.getElementById("icpText");if(icp&&s.icp)icp.textContent=s.icp;
        /* Analytics */
        if(s.analyticsCode&&!window.__siteAnalyticsApplied){
          window.__siteAnalyticsApplied=true;
          var host=document.createElement("div");host.style.display="none";host.innerHTML=String(s.analyticsCode);
          var scripts=host.querySelectorAll("script");
          scripts.forEach(function(old){
            var ns=document.createElement("script");
            for(var a of old.attributes)ns.setAttribute(a.name,a.value);
            if(old.textContent)ns.textContent=old.textContent;
            document.body.appendChild(ns);
          });
        }
      }).catch(function(){});
    }

    /* â•â• Bubbles â•â• */
    function setupBubbles(){
      var host=document.getElementById("bubbles");if(!host)return;
      var frag=document.createDocumentFragment();
      for(var i=0;i<14;i++){
        var b=document.createElement("div");b.className="bubble";
        var sz=22+Math.random()*60;
        b.style.width=sz.toFixed(1)+"px";b.style.height=sz.toFixed(1)+"px";
        b.style.left=(Math.random()*100).toFixed(4)+"%";
        b.style.animationDelay=(Math.random()*5).toFixed(3)+"s";
        b.style.animationDuration=(10+Math.random()*10).toFixed(3)+"s";
        frag.appendChild(b);
      }
      host.appendChild(frag);
    }

    /* â•â• Tab Switching â•â• */
    var currentTab="home";
    function switchTab(tab){
      currentTab=tab;
      $$(".tab-page").forEach(function(p){p.classList.remove("active")});
      var target=document.getElementById("tabHome");
      if(tab==="category")target=document.getElementById("tabCategory");
      else if(tab==="my")target=document.getElementById("tabMy");
      if(target)target.classList.add("active");
      $$("#bottomNav a").forEach(function(a){
        a.classList.toggle("active",a.dataset.tab===tab);
      });
      /* Restore scroll */
      window.scrollTo(0,0);
    }

    $$("#bottomNav a").forEach(function(a){
      a.addEventListener("click",function(e){
        e.preventDefault();
        switchTab(a.dataset.tab);
      });
    });

    /* â•â• Carousel â•â• */
    var slides=[];
    var curSlide=0;var slideTimer=null;
    async function loadCarousel(){
      try{
        const r = await fetch('/api/site_public.php');
        const j = await r.json();
        if(j.ok && j.settings.carousel && j.settings.carousel.length > 0){
          slides = j.settings.carousel;
        }else{
          // Fallback to default slides
          slides=[
            {bg:"linear-gradient(135deg,#7c83fd,#ff6b9d)",title:"æ¢ç´¢ä½ çš„å†…å¿ƒä¸–ç•Œ",sub:"ä¸“ä¸šå¿ƒç†æµ‹è¯„ï¼Œå¤šç»´åº¦è‡ªæˆ‘è®¤çŸ¥"},
            {bg:"linear-gradient(135deg,#f093fb,#f5576c)",title:"æ‹çˆ± Â· äººæ ¼ Â· æƒ…ç»ª",sub:"40+ ç§‘å­¦é‡è¡¨ï¼Œéšæ—¶éšåœ°æµ‹è¯„"},
            {bg:"linear-gradient(135deg,#667eea,#764ba2)",title:"äº†è§£è‡ªå·±ï¼Œæ‰èƒ½æ›´å¥½å‰è¡Œ",sub:"ç»“æœä»…ä¾›è‡ªæˆ‘è§‰å¯Ÿï¼Œè¯·å¯¹è‡ªå·±ä¿æŒå–„æ„"}
          ];
        }
      }catch(e){
        // Fallback to default slides on error
        slides=[
          {bg:"linear-gradient(135deg,#7c83fd,#ff6b9d)",title:"æ¢ç´¢ä½ çš„å†…å¿ƒä¸–ç•Œ",sub:"ä¸“ä¸šå¿ƒç†æµ‹è¯„ï¼Œå¤šç»´åº¦è‡ªæˆ‘è®¤çŸ¥"},
          {bg:"linear-gradient(135deg,#f093fb,#f5576c)",title:"æ‹çˆ± Â· äººæ ¼ Â· æƒ…ç»ª",sub:"40+ ç§‘å­¦é‡è¡¨ï¼Œéšæ—¶éšåœ°æµ‹è¯„"},
          {bg:"linear-gradient(135deg,#667eea,#764ba2)",title:"äº†è§£è‡ªå·±ï¼Œæ‰èƒ½æ›´å¥½å‰è¡Œ",sub:"ç»“æœä»…ä¾›è‡ªæˆ‘è§‰å¯Ÿï¼Œè¯·å¯¹è‡ªå·±ä¿æŒå–„æ„"}
        ];
      }
      renderCarousel();
    }
    function renderCarousel(){
      var track=document.getElementById("carouselTrack");
      var dots=document.getElementById("carouselDots");
      if(!track||!dots)return;
      track.innerHTML=slides.map(function(s){
        return '<div class="carousel-slide" style="background:'+s.bg+'"><div class="slide-text"><h2>'+escapeHtml(s.title)+'</h2><p>'+escapeHtml(s.sub)+'</p></div></div>';
      }).join("");
      dots.innerHTML=slides.map(function(_,i){
        return '<span data-i="'+i+'"'+(i===0?' class="active"':'')+'></span>';
      }).join("");
      dots.addEventListener("click",function(e){
        var sp=e.target.closest("span[data-i]");
        if(!sp)return;
        goSlide(Number(sp.dataset.i));
      });
      startSlideTimer();
    }
    function goSlide(i){
      curSlide=i;
      var track=document.getElementById("carouselTrack");
      if(track)track.style.transform="translateX(-"+i*100+"%)";
      $$("#carouselDots span").forEach(function(d,idx){d.classList.toggle("active",idx===i)});
    }
    function nextSlide(){curSlide=(curSlide+1)%slides.length;goSlide(curSlide)}
    function startSlideTimer(){clearInterval(slideTimer);slideTimer=setInterval(nextSlide,4000)}

    /* â•â• Category Quick Links â•â• */
    function renderCatRow(){
      var el=document.getElementById("catRow");if(!el)return;
      el.innerHTML=categories.map(function(c){
        return '<a class="cat-item" data-cat="'+escapeHtml(c)+'"><div class="cat-icon">'+(CAT_ICONS[c]||"ğŸ“‹")+'</div><span>'+escapeHtml(c)+'</span></a>';
      }).join("");
      el.addEventListener("click",function(e){
        var item=e.target.closest(".cat-item[data-cat]");
        if(!item)return;
        e.preventDefault();
        switchTab("category");
        setCatFilter(item.dataset.cat);
      });
    }

    /* â•â• Hot Items (by tags "çƒ­é—¨" or customized) â•â• */
    var featuredContent = null;
    async function loadFeaturedContent(){
      try{
        const r = await fetch('/api/site_public.php');
        const j = await r.json();
        if(j.ok && j.settings.featured){
          featuredContent = j.settings.featured;
        }
      }catch(e){
        featuredContent = null;
      }
    }
    function getHotTests(){
      // Check if custom hot items are configured
      if(featuredContent && featuredContent.hot && featuredContent.hot.enabled && featuredContent.hot.items && featuredContent.hot.items.length > 0){
        var customHot = [];
        featuredContent.hot.items.forEach(function(id){
          var t = TESTS.find(function(test){ return test.id === id; });
          if(t) customHot.push(t);
        });
        if(customHot.length > 0) return customHot.slice(0,8);
      }
      // Fallback to original logic
      var hot=TESTS.filter(function(t){return(t.tags||[]).some(function(tg){return tg==="çƒ­é—¨"||tg==="ç»¼åˆ"||tg==="è¶£å‘³"})});
      if(hot.length<4){
        /* Fallback: pick from various categories */
        var picked={};
        TESTS.forEach(function(t){
          if(!picked[t.category]){picked[t.category]=t}
        });
        hot=Object.values(picked);
      }
      return hot.slice(0,8);
    }
    function renderHotRow(){
      var el=document.getElementById("hotRow");if(!el)return;
      // Update section title if custom (find parent section's heading)
      if(featuredContent && featuredContent.hot && featuredContent.hot.title){
        var hotSection = el.parentElement;
        if(hotSection){
          var hotHead = hotSection.querySelector('.sec-head h3');
          if(hotHead) hotHead.textContent = featuredContent.hot.title;
        }
      }
      var hot=getHotTests();
      el.innerHTML=hot.map(function(t){
        var bg=CAT_GRADIENTS[t.category]||"linear-gradient(135deg,#ccc,#eee)";
        return '<a class="h-card" href="'+escapeHtml(viewPath(t.id))+'"><div class="h-card-img" style="background:'+bg+'"><span style="font-size:28px;filter:brightness(0) invert(1);opacity:.45;position:absolute">'+escapeHtml((t.tags||[])[0]||"æµ‹")+'</span></div><div class="h-card-body"><div class="name">'+escapeHtml(t.title)+'</div></div></a>';
      }).join("");
    }

    /* â•â• New Arrivals (last N added or customized) â•â• */
    function renderNewGrid(){
      var el=document.getElementById("newGrid");if(!el)return;
      // Update section title if custom (find parent section's heading)
      if(featuredContent && featuredContent.new && featuredContent.new.title){
        var newSection = el.parentElement;
        if(newSection){
          var newHead = newSection.querySelector('.sec-head h3');
          if(newHead) newHead.textContent = featuredContent.new.title;
        }
      }
      var items;
      // Check if custom new items are configured
      if(featuredContent && featuredContent.new && featuredContent.new.enabled && featuredContent.new.items && featuredContent.new.items.length > 0){
        items = [];
        featuredContent.new.items.forEach(function(id){
          var t = TESTS.find(function(test){ return test.id === id; });
          if(t) items.push(t);
        });
        if(items.length === 0) items = TESTS.slice(-6).reverse(); // fallback
      } else {
        /* Pick last 6 from the TESTS array (assumed newest) */
        items=TESTS.slice(-6).reverse();
      }
      el.innerHTML=items.map(function(t){
        var bg=CAT_GRADIENTS[t.category]||"linear-gradient(135deg,#ccc,#eee)";
        return '<a class="n-card" href="'+escapeHtml(viewPath(t.id))+'"><div class="n-card-img" style="background:'+bg+'"><span style="color:rgba(255,255,255,.6);font-size:22px">'+(CAT_ICONS[t.category]||"ğŸ“‹")+'</span></div><div class="n-card-body"><div class="name">'+escapeHtml(t.title)+'</div></div></a>';
      }).join("");
    }

    /* â•â• Featured Recommendations (customized or all tests) â•â• */
    var featPage=0;var FEAT_PER=6;
    function renderFeatList(){
      var el=document.getElementById("featList");if(!el)return;
      // Update section title if custom (find parent section's heading)
      if(featuredContent && featuredContent.recommended && featuredContent.recommended.title){
        var featSection = el.parentElement;
        if(featSection){
          var featHead = featSection.querySelector('.sec-head h3');
          if(featHead) featHead.textContent = featuredContent.recommended.title;
        }
      }
      var allItems;
      // Check if custom recommended items are configured
      if(featuredContent && featuredContent.recommended && featuredContent.recommended.enabled && featuredContent.recommended.items && featuredContent.recommended.items.length > 0){
        allItems = [];
        featuredContent.recommended.items.forEach(function(id){
          var t = TESTS.find(function(test){ return test.id === id; });
          if(t) allItems.push(t);
        });
        if(allItems.length === 0) allItems = TESTS; // fallback
      } else {
        allItems = TESTS;
      }
      var start=0;var end=Math.min((featPage+1)*FEAT_PER,allItems.length);
      var items=allItems.slice(start,end);
      el.innerHTML=items.map(function(t){
        var bg=CAT_GRADIENTS[t.category]||"linear-gradient(135deg,#ccc,#eee)";
        var q=(t.intro||"").split("ï¼Œ")[0]||"ä½ äº†è§£è‡ªå·±å—ï¼Ÿ";
        var count=peopleTested(t.id);
        return '<a class="feat-card" href="'+escapeHtml(viewPath(t.id))+'"><div class="feat-card-img" style="background:'+bg+'"><span style="color:rgba(255,255,255,.65);font-size:22px">'+(CAT_ICONS[t.category]||"ğŸ“‹")+'</span></div><div class="feat-card-body"><div class="question">'+escapeHtml(q)+'</div><div class="name">'+escapeHtml(t.title)+'</div><div class="meta-row"><span class="people"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="vertical-align:text-bottom"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M23 21v-2a4 4 0 0 0-3-3.87M16 3.13a4 4 0 0 1 0 7.75"/></svg> '+count+' äººæµ‹è¿‡</span><span>çº¦ '+escapeHtml(String(t.estimated||3))+' åˆ†é’Ÿ</span></div></div></a>';
      }).join("");
    }

    /* View More button */
    var vmBtn=document.getElementById("viewMoreBtn");
    if(vmBtn){
      vmBtn.addEventListener("click",function(e){
        e.preventDefault();
        if((featPage+1)*FEAT_PER<TESTS.length){
          featPage++;
          renderFeatList();
        } else {
          switchTab("category");
        }
      });
    }

    /* "å…¨éƒ¨" link */
    var catMoreBtn=document.getElementById("catMore");
    if(catMoreBtn){
      catMoreBtn.addEventListener("click",function(e){
        e.preventDefault();
        switchTab("category");
      });
    }

    /* â•â• Category Page â•â• */
    var catFilter="å…¨éƒ¨";
    var catSort="hot";
    var SORT_OPTIONS=[
      {key:"hot",label:"æŒ‰çƒ­åº¦"},
      {key:"time",label:"æŒ‰æ—¶é•¿"},
      {key:"name",label:"æŒ‰åç§°"}
    ];

    function setCatFilter(cat){
      catFilter=cat;
      renderCatSidebar();
      renderCatList();
    }
    function setCatSort(s){
      catSort=s;
      renderSortBar();
      renderCatList();
    }

    function renderCatSidebar(){
      var el=document.getElementById("catSidebar");if(!el)return;
      var all=["å…¨éƒ¨"].concat(categories);
      el.innerHTML=all.map(function(c){
        return '<button data-cat="'+escapeHtml(c)+'"'+(c===catFilter?' class="active"':'')+'>'+escapeHtml(c)+'</button>';
      }).join("");
      el.addEventListener("click",function(e){
        var btn=e.target.closest("button[data-cat]");
        if(!btn)return;
        setCatFilter(btn.dataset.cat);
      });
    }

    function renderSortBar(){
      var el=document.getElementById("sortBar");if(!el)return;
      el.innerHTML=SORT_OPTIONS.map(function(o){
        return '<button class="sort-btn'+(o.key===catSort?" active":"")+'" data-sort="'+o.key+'">'+escapeHtml(o.label)+'</button>';
      }).join("");
      el.addEventListener("click",function(e){
        var btn=e.target.closest("button[data-sort]");
        if(!btn)return;
        setCatSort(btn.dataset.sort);
      });
    }

    function renderCatList(){
      var el=document.getElementById("catList");if(!el)return;
      var searchQ=(document.getElementById("globalSearch")||{}).value||"";
      searchQ=searchQ.trim().toLowerCase();

      var list=TESTS.filter(function(t){
        var okCat=catFilter==="å…¨éƒ¨"||t.category===catFilter;
        var okQ=!searchQ||t.title.toLowerCase().indexOf(searchQ)!==-1||(t.tags||[]).some(function(tg){return tg.toLowerCase().indexOf(searchQ)!==-1})||t.id.toLowerCase().indexOf(searchQ)!==-1;
        return okCat&&okQ;
      });

      /* Sort */
      if(catSort==="hot"){
        list.sort(function(a,b){return peopleTested(b.id)-peopleTested(a.id)});
      }else if(catSort==="time"){
        list.sort(function(a,b){return(a.estimated||3)-(b.estimated||3)});
      }else if(catSort==="name"){
        list.sort(function(a,b){return a.title.localeCompare(b.title)});
      }

      if(list.length===0){
        el.innerHTML='<div style="text-align:center;padding:40px;color:var(--muted)">æ²¡æœ‰æ‰¾åˆ°åŒ¹é…çš„æµ‹è¯„ï¼Œè¯•è¯•æ¢ä¸ªå…³é”®è¯æˆ–åˆ†ç±»ã€‚</div>';
        return;
      }

      el.innerHTML=list.map(function(t){
        var bg=CAT_GRADIENTS[t.category]||"linear-gradient(135deg,#ccc,#eee)";
        var q=(t.intro||"").split("ï¼Œ")[0]||"ä½ äº†è§£è‡ªå·±å—ï¼Ÿ";
        var count=peopleTested(t.id);
        return '<a class="feat-card" href="'+escapeHtml(viewPath(t.id))+'"><div class="feat-card-img" style="background:'+bg+'"><span style="color:rgba(255,255,255,.65);font-size:22px">'+(CAT_ICONS[t.category]||"ğŸ“‹")+'</span></div><div class="feat-card-body"><div class="question">'+escapeHtml(q)+'</div><div class="name">'+escapeHtml(t.title)+'</div><div class="meta-row"><span class="people"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="vertical-align:text-bottom"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M23 21v-2a4 4 0 0 0-3-3.87M16 3.13a4 4 0 0 1 0 7.75"/></svg> '+count+' äººæµ‹è¿‡</span><span>çº¦ '+escapeHtml(String(t.estimated||3))+' åˆ†é’Ÿ</span></div></div></a>';
      }).join("");
    }

    /* â•â• Global Search â•â• */
    var searchInput=document.getElementById("globalSearch");
    if(searchInput){
      searchInput.addEventListener("input",function(){
        if(currentTab==="category"){
          renderCatList();
        }else{
          /* Switch to category tab for search results */
          if(searchInput.value.trim()){
            switchTab("category");
            renderCatList();
          }
        }
      });
    }

    /* â•â• My Tab â•â• */
    function renderMyTab(){
      var titleEl=document.getElementById("myStatusTitle");
      var subEl=document.getElementById("myStatusSub");
      var infoEl=document.getElementById("myAuthInfo");
      var activateBtn=document.getElementById("myActivateBtn");
      if(isAuthed()){
        var auth=window.Auth.getAuth();
        if(titleEl)titleEl.textContent="å·²æ¿€æ´» âœ…";
        if(subEl)subEl.textContent="ä½ å¯ä»¥ä½¿ç”¨æ‰€æœ‰æµ‹è¯„åŠŸèƒ½";
        if(infoEl){
          var expStr="";
          if(auth.exp){
            var d=new Date(auth.exp*1000);
            expStr="æœ‰æ•ˆæœŸè‡³ "+d.getFullYear()+"-"+String(d.getMonth()+1).padStart(2,"0")+"-"+String(d.getDate()).padStart(2,"0")+" "+String(d.getHours()).padStart(2,"0")+":"+String(d.getMinutes()).padStart(2,"0");
          }
          infoEl.textContent=expStr||"æƒé™å·²æ¿€æ´»";
        }
        if(activateBtn){activateBtn.textContent="æŸ¥çœ‹æƒé™çŠ¶æ€"}
      }else{
        if(titleEl)titleEl.textContent="æœªæ¿€æ´»";
        if(subEl)subEl.textContent="æ¿€æ´»åå³å¯ä½¿ç”¨å…¨éƒ¨æµ‹è¯„";
        if(infoEl)infoEl.textContent="ä½ å½“å‰å°šæœªæ¿€æ´»æƒé™ï¼Œè¯·è¾“å…¥æ¿€æ´»ç å¼€å§‹ä½¿ç”¨ã€‚";
        if(activateBtn){activateBtn.textContent="æ¿€æ´»æƒé™"}
      }
    }

    /* â•â• Init â•â• */
    loadSiteSettings();
    setupBubbles();
    // Load and render carousel
    loadCarousel();
    renderCatRow();
    // Load featured content and render sections
    loadFeaturedContent().then(function(){
      renderHotRow();
      renderNewGrid();
      renderFeatList();
    });
    renderCatSidebar();
    renderSortBar();
    renderCatList();
    renderMyTab();
  })();
  </script>
</body>
</html>
